<?xml version="1.0"?>
<launch>
  <arg name="use_sim_time" default="true"/>
  <arg name="params_file" default="/home/tech/IGVC_SIM/nav2_params_fused.yaml"/>
  <arg name="autostart" default="true"/>
  
  <!-- Perception Stack (Lane Detection + Point Cloud Fusion) -->
  <include file="$(find-pkg-share orange_perception)/launch/perception.launch.xml">
    <arg name="use_sim_time" value="$(var use_sim_time)"/>
    <arg name="debug_viz" value="false"/>
  </include>
  
  <!-- Navigation2 - With Fused Perception -->
  <node pkg="nav2_controller" exec="controller_server" output="screen">
    <param name="use_sim_time" value="$(var use_sim_time)"/>
    <param from="$(var params_file)"/>
  </node>

  <node pkg="nav2_planner" exec="planner_server" output="screen">
    <param name="use_sim_time" value="$(var use_sim_time)"/>
    <param from="$(var params_file)"/>
  </node>

  <node pkg="nav2_behaviors" exec="behavior_server" output="screen">
    <param name="use_sim_time" value="$(var use_sim_time)"/>
    <param from="$(var params_file)"/>
  </node>

  <node pkg="nav2_bt_navigator" exec="bt_navigator" output="screen">
    <param name="use_sim_time" value="$(var use_sim_time)"/>
    <param from="$(var params_file)"/>
  </node>

  <node pkg="nav2_lifecycle_manager" exec="lifecycle_manager" name="lifecycle_manager_navigation" output="screen">
    <param name="use_sim_time" value="$(var use_sim_time)"/>
    <param name="autostart" value="$(var autostart)"/>
    <param name="node_names" value="['controller_server', 'planner_server', 'behavior_server', 'bt_navigator']"/>
  </node>
</launch>
